     *= $2000    ;ASSEMBLE TO $2000     SEI         ;DISABLE IRQ'S     LDA #$7F    ;DISABLE CIA IRQ'S     STA $DC0D     STA $DD0D     LDA #$35    ;BANK OUT KERNAL&BASIC     STA $01     ;$E000-$FFFF     LDA #<IRQ1  ;INSTALL RASTER IRQ     LDX #>IRQ1  ;INTO HARDWARE     STA $FFFE   ;INTERRUPT VECTOR     STX $FFFF     LDA #$01    ;ENABLE RASTER IRQS     STA $D01A     LDA #52     ;IRQ ON LINE 52     STA $D012     LDA #$1B  ;HIGH BIT (LINES 256-311)     STA $D011        ;NOTE DOUBLE IRQ        ;CANNOT BE ON OR        ;AROUND A BAD LINE!        ;(FAST LINE)     LDA #$0E    ;SET BACKGROUND     STA $D020   ;AND BORDER COLORS     LDA #$06     STA $D021     LDA #$00     STA $D015   ;TURN OFF SPRITES     JSR CLRSCREEN     JSR CLRCOLOR     JSR PRINTTEXT     ASL $D019   ;ACK ANY PREVIOUS     BIT $DC0D   ;IRQ'S     BIT $DD0D     CLI         ;ALLOW IRQ'S     JMP *       ;ENDLESS LOOPIRQ1     STA RESETA1 ;PRESERVE A,X AND Y     STX RESETX1 ;REGISTERS     STY RESETY1 ;VIA SELF MODIFYING        ;CODE        ;(FASTER THAN THE        ;STACK IS!)     LDA #<IRQ2  ;SET IRQ VECTOR     LDX #>IRQ2  ;TO POINT TO THE        ;NEXT PART OF THE     STA $FFFE   ;STABLE IRQ     STX $FFFF   ;ON NEXT LINE!     INC $D012     ASL $D019   ;ACK RASTER IRQ     TSX         ;WE WANT THE IRQ     CLI         ;TO RETURN TO OUR     NOP         ;ENDLESS LOOP     NOP         ;NOT THE END OF     NOP         ;THIS IRQ!     NOP     NOP         ;EXECUTE NOP'S     NOP         ;UNTIL NEXT RASTER     NOP         ;IRQ TRIGGERS     NOP     NOP         ;2 CYCLES PER     NOP         ;INSTRUCTION SO     NOP         ;WE WILL BE WITHIN     NOP         ;1 CYCLE OF RASTER     NOP         ;REGISTER CHANGE     NOPIRQ2     TXS         ;RESTORE STACK        ;POINTER     LDX #$08    ;WAIT EXACTLY 1     DEX         ;LINES WORTH OF     BNE *-1     ;CYCLES FOR COMPARE     BIT $EA     ;ÕINUS COMPARE     NOP         ;CYCLES;    NOP  ;<--- REMOVE 1 NOP FOR PAL     LDA #53     ;RASTER CHANGE YET?     CMP $D012     BEQ START   ;IF NO WASTE 1 MORE        ;CYCLESTART     NOP         ;SOME DELAY     NOP         ;SO STABLE CAN BE     NOP         ;SEENLINE1     LDA #$0E    ;COLORS     LDX #$06     STA $D021   ;HERE IS THE PROOF     STX $D021     LDA #<IRQ3  ;SET IRQ TO POINT     LDX #>IRQ3  ;TO SUBSEQUENT IRQ     LDY #104    ;AT LINE $68     STA $FFFE     STX $FFFF     STY $D012     ASL $D019   ;ACK RASTER IRQ     LDA #$00    ;RELOAD A,X,AND YRESETA1 = *-1    ;REGISTERS     LDX #$00RESETX1 = *-1     LDY #$00RESETY1 = *-1     RTI         ;RETURN FROM IRQIRQ3     STA RESETA2 ;PRESERVE A,X,AND Y     STX RESETX2 ;REGISTERS     STY RESETY2     LDX #$09    ;WASTE SOME MORE     DEX         ;TIME SO EFFECT     BNE *-1     ;CAN BE SEEN     NOP     NOPLINE2     LDA #$0E    ;MORE COLORS     LDX #$06     STA $D021   ;COOL! SUBSEQUENT     STX $D021   ;IRQ'S ARE ALSO        ;STABLE :-)        ;UNLESS YOU ARE        ;RUNNING REALTIME        ;CODE :-)     LDY #$13    ;WASTE TIME SO THIS     DEY         ;IRQ DOES NOT TRY     BNE *-1     ;TO REOCCUR ON THE        ;SAME LINE!     LDA #<IRQ1  ;RESET VECTORS TO     LDX #>IRQ1  ;FIRST IRQ AGAIN     LDY #52     ;AT LINE $34     STA $FFFE     STX $FFFF     STY $D012     ASL $D019   ;ACK RASTER IRQ     LDA #$00    ;RELOAD A,X,AND YRESETA2 = *-1    ;REGISTERS     LDX #$00RESETX2 = *-1     LDY #$00RESETY2 = *-1     RTI         ;RETURN FROM …“—        ;POUND RESTORE TO        ;GET BACK TO TURBONMI     ASL $D019   ;ACK ALL IRQ'S     LDA $DC0D     LDA $DD0D     LDA #$81    ;RESET CIA 1 IRQ     LDX #$00    ;REMOVE RASTER IRQ     LDY #$37    ;RESET MMU TO ROMS     STA $DC0D     STX $D01A     STY $01     LDX #$FF    ;CLEAR THE STACK     TXS     CLI         ;REENABLE IRQ'S     JMP $9000   ;BACK TO TURBOCLRSCREEN     LDA #$20    ;CLEAR THE SCREEN     LDX #$00CLRSCR     STA $0400,X     STA $0500,X     STA $0600,X     STA $0700,X     DEX     BNE CLRSCR     RTSCLRCOLOR     LDA #$03    ;CLEAR COLOR MEMORY     LDX #$00CLRCOL     STA $D800,X     STA $D900,X     STA $DA00,X     STA $DB00,X     DEX     BNE CLRCOL     RTSPRINTTEXT     LDA #$16    ;C-SET = LOWER CASE     STA $D018     LDX #$00MORETEXT     LDA MESSAGE,X     BPL LOWER   ;UPPER CASE ?     EOR #$80    ;YES     BNE LOWER+2LOWER     AND #$3F    ;LOWER CASE     STA $0450,X     INX     CPX #120    ; WRITE 4 LINES     BNE MORETEXTEXIT     RTSMESSAGE     .TEXT "STABLE RASTER IRQ SOURCE"     .TEXT "(PAL/NTSC)      "     .TEXT "CODE BASED ON SOURCE BY "     .TEXT "FUNGUS 1996"